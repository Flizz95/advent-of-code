with open('input.txt',"r") as f:
    towels, designs = f.read().split('\n\n')
    towels = towels.split(", ")
    designs = designs.split("\n")

total = 0

#set to store possible towel arrangements
towel_mem = set()

def rec(d, dr, size, length):
    #expand towel_mem
    if dr != '':
        towel_mem.add(dr)
    #terminate
    if size == length:
        return True
    #loop over known possible towel arrangements
    for tm in towel_mem.copy():
        if tm == d[0:len(tm)]:
            if rec(d[len(tm):], dr + d[:len(tm)], size + len(tm),length):
                return True
    #loop over all remaining towels
    for t in towels:
        if t == d[0:len(t)]:
            if rec(d[len(t):], dr + d[:len(t)], size + len(t),length):
                return True
    return False
                
for i,d in enumerate(designs):
    if rec(d,'',0,len(d)):
        total += 1

print(total)
